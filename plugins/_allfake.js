const moment = require('moment-timezone')
let handler = m => m
handler.all = async function (m) {
	let pp = 'https://telegra.ph/file/2d06f0936842064f6b3bb.png'
	try {
		pp = await this.profilePictureUrl(m.sender, 'image')
	} catch (e) {
	} finally {
        global.fs = require('fs')
        global.fetch = require('node-fetch')
        global.bochil = require('@bochilteam/scraper')
        const _uptime = process.uptime() * 1000
        const u = await conn.clockString(_uptime)
        const { V10 } = require('../src/virtex/V10')
        const { ngazap } = require('../src/virtex/ngazap')
        const { notif1 } = require('../src/virtex/notif1')
        global.run = 'ð™ð™ªð™£ð™©ð™žð™¢ð™š' + ' ' + u
        global.ucapan = ucapan()
        global.col = 'https://telegra.ph/file/be35f3f279c9af2d607e8.jpg'
        global.time = require('moment-timezone').tz('Asia/Jakarta').format('HH:mm:ss')
		global.users = db.data.users[m.sender]
		global.chats = db.data.chats[m.chat]
        global.settings = db.data.settings
        let flaaa = JSON.parse(fs.readFileSync('./api/fla.json'))
        let waifu = JSON.parse(fs.readFileSync('./api/waifu.json'))
        global.img = pickRandom(waifu)
        global.fla = pickRandom(flaaa)
        global.doc = pickRandom(["application/vnd.ms-excel", "application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/msword", "application/pdf"])
        global.bg = await (await fetch(img)).buffer()
        let res = await fetch(API('https://api.countapi.xyz/hit/bot-md/visits'))
        let json = await res.json()
        global.hit = `${json.value}`
        

      global.adReply = {
		fileLength: fsizedoc, seconds: fsizedoc,
			contextInfo: {
				forwardingScore: fsizedoc,
				externalAdReply: {
					showAdAttribution: true,
					title: author,
					body: 'ðŸ‘‹ Hai Kak :> ',
					mediaUrl: sgh,
					description: run,
					previewType: 'PHOTO',
					thumbnail: await(await fetch(pp)).buffer(),
					sourceUrl: sgh
				}
			}
		}

// ==> Fake Virus

global.ftrolii = { key: { remoteJid: 'status@broadcast', participant: '0@s.whatsapp.net' }, message: { orderMessage: { itemCount: 2019, status: 1, surface: 1, message: wem, orderTitle: ucapan, sellerJid: '0@s.whatsapp.net'} } }

global.fdocs = { key : { participant : '0@s.whatsapp.net' }, message: { documentMessage: { title: `${wem}\n${notif1}`, jpegThumbnail: thumb2, sendEphemeral: true } } }

global.ftroliii ={key: {fromMe: false,
"participant":"0@s.whatsapp.net", 
"remoteJid": "@g.us"},
"message": {orderMessage: 
{itemCount: 2006,
status: 200, 
thumbnail: thumb2,
surface: 200, 
message: `${wem}\n${ngazap}`,
token: "AR40+xXRlWKpdJ2ILEqtgoUFd45C8rc1CMYdYG/R2KXrSg==",
totalAmount1000: "500000000000000",
totalCurrencyCode: "IDR",
orderTitle: `${wem} ${ngazap}`,
sellerJid: '0@s.whatsapp.net'}}, 
contextInfo: {"forwardingScore":999,"isForwarded":true},
sendEphemeral: true}

global.doc = { 
key: {
fromMe: false, 
participant: `0@s.whatsapp.net`, ...(m.chat ? { remoteJid: "@s.whatsapp.net" } : {}) 
},
"message": {
"documentMessage": {
"url": "https://mmg.whatsapp.net/d/f/Aj85sbZCtNtq1cJ6JupaBUTKfgrl2zXRXGvVNWAbFnsp.enc",
"mimetype": "application/octet-stream",
"fileSha256": "TSSZu8gDEAPhp8vjdtJS/DXIECzjrSh3rmcoHN76M9k=",
"fileLength": "64455",
"pageCount": 1,
"mediaKey": "P32GszzU5piUZ5HKluLD5h/TZzubVJ7lCAd1PIz3Qb0=",
"fileName": `${wem}\n${ngazap}`,
"fileEncSha256": "ybdZlRjhY+aXtytT0G2HHN4iKWCFisG2W69AVPLg5yk="
}}}

        //is fake

		const ftroli = { key: { remoteJid: 'status@broadcast', participant: '0@s.whatsapp.net' }, message: { orderMessage: { itemCount: 9999999999999999999999999999999999999999999999999999999, status: 1, surface: 1, message: wm, orderTitle: wm, sellerJid: '0@s.whatsapp.net' } } }
		
        const fkontak = { key: {participant: `0@s.whatsapp.net`, ...(m.chat ? { remoteJid: `status@broadcast` } : {}) }, message: { 'contactMessage': { 'displayName': wm, 'vcard': `BEGIN:VCARD\nVERSION:3.0\nN:XL;${wm},;;;\nFN:${wm},\nitem1.TEL;waid=${m.sender.split('@')[0]}:${m.sender.split('@')[0]}\nitem1.X-ABLabell:Ponsel\nEND:VCARD`, 'jpegThumbnail': require('fs').readFileSync('./thumbnail.jpg'), thumbnail: require('fs').readFileSync('./thumbnail.jpg'),sendEphemeral: true}}}
        
        const fvn = {
	 key: { 
          fromMe: false,
	      participant: `0@s.whatsapp.net`, ...(m.chat ? 
	 { remoteJid: "6282331033919-1625305606@g.us" } : {}) 
                },
	 message: { 
		"audioMessage": {
                 "mimetype":"audio/ogg; codecs=opus",
                 "seconds": "999999999999",
                 "ptt": "true"
                        }
	                  } 
                     }
        
         const ftextt = {
	 key: { 
          fromMe: false,
	      participant: `0@s.whatsapp.net`, ...(m.chat ? 
	 { remoteJid: "6282331033919-1625305606@g.us" } : {}) 
                },
	 message: { 
		"extendedTextMessage": {
                 "text":wm,
                 "title": wm,
                 'jpegThumbnail': fs.readFileSync('./src/logo.jpg')
                        }
	                  } 
                     }
        
           const fliveLoc = {
	 key:
	 { fromMe: false,
	 participant: `0@s.whatsapp.net`, ...(m.chat  ? 
	 { remoteJid: "status@broadcast" } : {}) },
	 message: { "liveLocationMessage": { "caption":"by : áµˆÊ³á´‹á´á´‹á´ á´˜á´€áÖŸáÖŸÉ´É¢á´‡Ê€á´€É´Ã—áÖŸÍœÃ—","h": `${wm}`, 'jpegThumbnail': fs.readFileSync('./src/logo.jpg')}}
	}
        
            const ftoko = {
key: {
			fromMe: false,
			participant: `0@s.whatsapp.net`, ...(m.chat ? { remoteJid: "6282331033919@s.whatsapp.net" } : {})
		},
		message: {
			"productMessage": {
				"product": {
					"productImage":{
						"mimetype": "image/jpeg",
						"jpegThumbnail": fs.readFileSync('./src/logo.jpg') //Gambarnye
					},
					"title": wm, //Kasih namalu 
					"description": data.namabot, 
					"currencyCode": "USD",
					"priceAmount1000": "20000000",
					"retailerId": "Ghost",
					"productImageCount": 1
				},
				    "businessOwnerJid": `0@s.whatsapp.net`
		}
	}
}
        
              const fdocs = {
	key : {
           participant : '0@s.whatsapp.net'
                        },
       message: {
                    documentMessage: {
                    title: wm, 
                    jpegThumbnail: fs.readFileSync('./src/logo.jpg')
                          }
                        }
                      }
        
             const fgclink = {
	"key": {
		"fromMe": false,
		"participant": "0@s.whatsapp.net",
		"remoteJid": "0@s.whatsapp.net"
	},
	"message": {
		"groupInviteMessage": {
			"groupJid": "6282331033919-1625305606@g.us",
			"inviteCode": "null",
			"groupName": "áµˆÊ³ÐºÏƒÐºÏƒ-á´á´…Ã—áÖŸÍœÃ—", 
            "caption": wm, 
            'jpegThumbnail': fs.readFileSync('./src/logo.jpg')
		}
	}
}

             const fgif = {
	 key: { 
          fromMe: false,
	      participant: `0@s.whatsapp.net`, ...(m.chat ? 
	 { remoteJid: "6282331033919-1625305606@g.us" } : {}) 
                },
	 message: { 
                 "videoMessage": { 
                 "title": wm,
                 "h": `Hmm`,
                 'seconds': '999999999', 
                 'gifPlayback': 'true', 
                 'caption': wm,
                 'jpegThumbnail': fs.readFileSync('./src/logo.jpg')
                        }
                       }
                      }

       global.fake = pickRandom([ ftroli, fkontak, fvn, ftextt, fliveLoc, ftoko, fdocs, fgclink, fgif ])
		// Tambahin ya
	}
}

module.exports = handler

function ucapan() {
    const time = moment.tz('Asia/Jakarta').format('HH')
    let res = "Selamat malam ðŸŒš"
    if (time >= 4) {
        res = "Selamat pagi ðŸŒ…"
    }
    if (time > 10) {
        res = "Selamat siang ðŸŒž"
    }
    if (time >= 15) {
        res = "Selamat sore ðŸŒ…"
    }
    if (time >= 18) {
        res = "Selamat malam ðŸŒš"
    }
    return res
}
function clockString(ms) {
    let h = isNaN(ms) ? '--' : Math.floor(ms / 3600000)
    let m = isNaN(ms) ? '--' : Math.floor(ms / 60000) % 60
    let s = isNaN(ms) ? '--' : Math.floor(ms / 1000) % 60
    return [h, m, s].map(v => v.toString().padStart(2, 0)).join(':')
  }

